---
import Bars from './Bars.astro'
import { getCollection } from 'astro:content'

import svgUnderline from '../assets/underline.svg'
import arrowCard from '../assets/arrow-card.svg'

// Get portfolio items - show pinned ones first, then latest, limit to 4
const allPortfolios = await getCollection('portfolio')

// Sort: pinned to homepage first, then by date (newest first)
const sortedPortfolios = allPortfolios.sort((a, b) => {
  // Pinned items come first
  if (a.data.pinnedToHomepage && !b.data.pinnedToHomepage) return -1
  if (!a.data.pinnedToHomepage && b.data.pinnedToHomepage) return 1

  // Then sort by date
  return b.data.date.getTime() - a.data.date.getTime()
})

// Take only first 4 for homepage
const portfolioProjects = sortedPortfolios.slice(0, 4)

// Get unique categories from all portfolios (for future use)
const categories = ['All', ...new Set(allPortfolios.map(p => p.data.category))]
---

<section class='space-y-10 px-5 py-25' id='work'>
  <div class='relative mx-auto max-w-md'>
    <h1 class='text-center text-4xl font-medium'>My Portfolio</h1>
    <img src={svgUnderline.src} alt='arrow' width='140' class='absolute -bottom-1 left-50' />
  </div>

  <div class='mx-auto grid max-w-3xl grid-cols-1 gap-10 md:grid-cols-2'>
    {
      portfolioProjects.map(project => (
        <a
          href={`/portfolio/${project.id.replace(/\.mdx?$/, '')}`}
          class='group relative flex flex-col bg-white p-5 transition-all duration-200 hover:shadow-[4px_4px_0px_rgba(0,0,0,0.3)]'
        >
          <div class='h-[200px] w-full overflow-hidden border-2'>
            <img
              src={project.data.coverImage}
              alt={project.data.title}
              loading='lazy'
              class='h-full w-full object-cover'
            />
          </div>
          <div class='space-y-1 pt-4'>
            <div class='flex pr-2'>
              <h2 class='flex-1 text-xl font-medium'>{project.data.title}</h2>
              <img src={arrowCard.src} alt='arrow' width='25' />
            </div>
            <p class='mb-2 text-sm text-gray-600'>
              {project.data.category} â€¢ {project.data.client}
            </p>
            <p class='mr-20'>{project.data.shortDescription}</p>
          </div>
          <Bars />
        </a>
      ))
    }
  </div>

  <!-- View All Portfolio Button -->
  <div class='mx-auto flex max-w-3xl justify-center pt-5'>
    <a
      href='/portfolio'
      class='bg-yellow border-2 border-black px-8 py-4 text-lg font-bold transition-all duration-200 hover:shadow-[4px_4px_0px_rgba(0,0,0,0.3)]'
    >
      View All Portfolio
      <i class='ri-arrow-right-line ml-2'></i>
    </a>
  </div>
</section>
